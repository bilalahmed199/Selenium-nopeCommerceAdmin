from pageObjects.LoginPage import loginPage
from utilities.readProperties import ReadConfig 
from utilities.customLogger import LogGenerator
from utilities import excelReader

# data driven testing
# data is readed from Excel file
class Test_002_DDT_Login:
    baseURL = ReadConfig().getAppURL()
    # excel file path
    path = ".//testData/testData.xlsx"

    logger = LogGenerator().log_generator()
   
    def test_Login_DDT(self, setup ):
        self.logger.info("****** Test_002_Login_DDT******")
        self.logger.info("****** Verifying user Loggedin with valid data or not from excel file ******")
        
        self.driver = setup
        self.driver.get(self.baseURL)

        self.lp = loginPage(self.driver)
        # reading data from excel file
        self.rows = xcelReader.getRowCount(self.path, "Sheet1" )
        print("No. of rows in excel file: ", self.rows)
        for r in range(2, self.rows + 1):
            self.userName = excelReader.readDAta(self.path, "Sheet1",r,1)
            self.password = excelReader.readDAta(self.path, "Sheet1",r,2)
            self.expectedResult = excelReader.readDAta(self.path, "Sheet1",r,3)

            self.lp.setUsername(self.userName)
            self.lp.setPassword(self.password)
            self.lp.clickLogin()
            time.sleep(3)

            act_title = self.driver.title
            exp_title = "Dashboard / nopCommerce administration"

            if act_title == exp_title:
                if self.expectedResult == "Pass":
                    self.logger("***** Passed *****")
                    self.lp.clickLogout()





        self.lp.setUsername(self.username)
        self.lp.setPassword(self.password)
        self.lp.clickLogin()

        act_title = self.driver.title
        if act_title == "Dashboard / nopCommerce administration":
            assert True
            self.driver.close()
            self.logger.info("****** Login test passed ******")

        else:
            self.driver.save_screenshot(".\\Screenshots\\" + "test_login.png")
            self.driver.close()
            self.logger.error("****** Login test failed ******")
            assert False